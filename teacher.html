<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher Dashboard</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase Librares -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="./firebase.js"></script>

<style>
body { font-family: Arial, sans-serif; background:#f4f4f9; margin:0; padding:0; }
header { background:#2196F3; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:1.5rem; }
.btn { padding:6px 12px; margin:2px; border:none; cursor:pointer; border-radius:4px; }
.logout { background:#F44336; color:white; }
.dashboard-container { padding:15px; }
.class-card { background:white; padding:10px; margin:10px 0; border-radius:6px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.student-card { margin:5px 0; }
.present { background:#4CAF50; color:white; }
.absent { background:#F44336; color:white; }
</style>
</head>
<body>

<header>
  <h1>üßë‚Äçüè´ Teacher Dashboard</h1>
  <button class="btn logout" onclick="logout()">Logout</button>
</header>

<div class="dashboard-container">
  <button class="btn" onclick="addClass()">‚ûï Add Class</button>
  <h2>Your Classes</h2>
  <div id="classes-list"></div>

  <div id="students-section" style="display:none;">
    <h3 id="class-title"></h3>
    <button class="btn" onclick="addStudent()">‚ûï Add Student</button>
    <div id="students-list"></div>
  </div>
</div>

<script>
let currentTeacherUid = "";
let currentClassName = "";

// Check if user is logged in
auth.onAuthStateChanged(user => {
  if(user){
    currentTeacherUid = user.uid;
    loadClasses();
  } else {
    window.location = "login.html";
  }
});

// Logout
function logout(){
  auth.signOut().then(()=> window.location="login.html");
}

// Load all classes of this teacher
function loadClasses(){
  const classesRef = database.ref(`teachers/${currentTeacherUid}/classes`);
  const classesList = document.getElementById("classes-list");
  classesList.innerHTML = "";

  classesRef.on("value", snapshot => {
    classesList.innerHTML = "";
    snapshot.forEach(classSnap => {
      const className = classSnap.key;
      const div = document.createElement("div");
      div.className = "class-card";
      div.innerHTML = `<strong>${className}</strong> 
        <button class="btn" onclick="viewClass('${className}')">View Students</button>`;
      classesList.appendChild(div);
    });
  });
}

// Add new class
function addClass(){
  const className = prompt("Enter new class name:");
  if(!className) return;
  database.ref(`teachers/${currentTeacherUid}/classes/${className}`).set({
    students: {},
    attendance: {}
  }).then(() => loadClasses());
}

// View students of a class
function viewClass(className){
  currentClassName = className;
  document.getElementById("students-section").style.display = "block";
  document.getElementById("class-title").textContent = "Class: " + className;
  loadStudents(className);
}

// Load students
function loadStudents(className){
  const studentsRef = database.ref(`teachers/${currentTeacherUid}/classes/${className}/students`);
  const studentsList = document.getElementById("students-list");
  studentsList.innerHTML = "";

  studentsRef.on("value", snapshot => {
    studentsList.innerHTML = "";
    snapshot.forEach(studentSnap => {
      const roll = studentSnap.key;
      const student = studentSnap.val();
      const div = document.createElement("div");
      div.className = "student-card";
      div.innerHTML = `${student.name} (Roll: ${roll}) 
        <button id="present-${roll}" class="btn" onclick="markAttendance('${roll}','present')">Present</button>
        <button id="absent-${roll}" class="btn" onclick="markAttendance('${roll}','absent')">Absent</button>`;
      studentsList.appendChild(div);
    });
  });
}

// Add student to current class
function addStudent(){
  const studentName = prompt("Enter student name:");
  const rollNumber = prompt("Enter roll number:");
  if(!studentName || !rollNumber) return;

  database.ref(`teachers/${currentTeacherUid}/classes/${currentClassName}/students/${rollNumber}`).set({
    name: studentName
  }).then(()=> loadStudents(currentClassName));
}

// Mark attendance
function markAttendance(rollNumber, status){
  const date = new Date().toISOString().split('T')[0];
  const ref = database.ref(`teachers/${currentTeacherUid}/classes/${currentClassName}/attendance/${date}/${rollNumber}`);
  ref.set(status).then(()=>{
    document.getElementById(`present-${rollNumber}`).className = status === "present" ? "btn present" : "btn";
    document.getElementById(`absent-${rollNumber}`).className = status === "absent" ? "btn absent" : "btn";
  });
}

</script>
</body>
</html>
