<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase Libraries -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="firebase.js"></script>

<style>
body { font-family: Arial, sans-serif; background:#f0f4f8; margin:0; padding:0; }
header { background:#4CAF50; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:1.5rem; }
.main { padding:20px; }
.attendance-card { background:white; padding:12px; margin:10px 0; border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,0.1); }
.attendance-card h3 { margin:0 0 5px 0; }
.attendance-card p { margin:3px 0; }
.defaulter { color:#F44336; font-weight:bold; }
</style>
</head>
<body>

<header>
  <h1>üë®‚Äçüéì Student Dashboard</h1>
  <button class="btn" onclick="signOutUser()">Logout</button>
</header>

<div class="main">
  <h2>My Attendance</h2>
  <div id="attendance-list">Loading...</div>
</div>

<script>
checkAuth();

const uid = auth.currentUser.uid;
const attendanceList = document.getElementById("attendance-list");

// Load student's attendance
database.ref("students/" + uid + "/attendance").on("value", snapshot => {
  attendanceList.innerHTML = "";
  if(!snapshot.exists()) { attendanceList.innerHTML = "No attendance data yet."; return; }

  snapshot.forEach(classSnap => {
    const className = classSnap.key;
    const dates = classSnap.val();
    let presentCount = 0;
    let totalCount = 0;

    const card = document.createElement("div");
    card.className = "attendance-card";
    let attendanceHTML = `<h3>${className}</h3><ul>`;

    for(let date in dates) {
      totalCount++;
      if(dates[date] === "present") presentCount++;
      attendanceHTML += `<li>${date}: ${dates[date]}</li>`;
    }
    attendanceHTML += "</ul>";

    let percentage = ((presentCount/totalCount)*100).toFixed(1);
    attendanceHTML += `<p>Attendance: ${presentCount}/${totalCount} (${percentage}%)</p>`;

    if(percentage < 75) attendanceHTML += `<p class="defaulter">‚ö† Defaulter Alert! Attendance below 75%</p>`;

    card.innerHTML = attendanceHTML;
    attendanceList.appendChild(card);
  });
});
</script>

</body>
</html>
