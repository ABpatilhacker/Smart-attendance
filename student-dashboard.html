<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="firebase.js"></script>

<style>
.main { margin-left:200px; padding:20px; }
.sidebar { width:200px; background:#333; color:white; height:100vh; position:fixed; top:0; left:0; padding-top:60px; display:flex; flex-direction:column; }
.sidebar button { background:none; border:none; color:white; padding:12px; text-align:left; width:100%; cursor:pointer; font-size:1rem; }
.sidebar button:hover { background:#575757; }
.attendance-card { background:white; padding:12px; margin:10px 0; border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,0.1); }
.attendance-card h3 { margin:0 0 5px 0; }
.defaulter { color:#F44336; font-weight:bold; }
@media screen and (max-width:768px){ .main{ margin-left:0; padding:10px;} .sidebar{width:100%; height:auto; position:relative; flex-direction:row;} .sidebar button{ flex:1; text-align:center; } }
</style>
</head>
<body>

<header>
  <h1>üë®‚Äçüéì Student Dashboard</h1>
  <button class="btn logout" onclick="signOutUser()">Logout</button>
</header>

<div class="sidebar">
  <button onclick="showSection('attendance-section')">My Attendance</button>
</div>

<div class="main">
  <div id="attendance-section">
    <h2>My Attendance</h2>
    <div id="attendance-list">Loading...</div>
  </div>
</div>

<script>
checkAuth();

const uid = auth.currentUser.uid;
const attendanceList = document.getElementById("attendance-list");

// Show/hide sections
function showSection(id){
  document.getElementById('attendance-section').style.display='none';
  document.getElementById(id).style.display='block';
}

// Load attendance
function loadAttendance(){
  database.ref("students/"+uid+"/attendance").on("value", snap=>{
    attendanceList.innerHTML="";
    if(!snap.exists()){ attendanceList.innerHTML="No attendance data yet."; return; }

    snap.forEach(classSnap=>{
      const className=classSnap.key;
      const dates=classSnap.val();
      let presentCount=0;
      let totalCount=0;

      const card=document.createElement("div");
      card.className="attendance-card";
      let html=`<h3>${className}</h3><ul>`;

      for(let date in dates){
        totalCount++;
        if(dates[date]==="present") presentCount++;
        html+=`<li>${date}: ${dates[date]}</li>`;
      }
      html+="</ul>";

      let percentage=((presentCount/totalCount)*100).toFixed(1);
      html+=`<p>Attendance: ${presentCount}/${totalCount} (${percentage}%)</p>`;

      if(percentage<75) html+=`<p class="defaulter">‚ö† Defaulter Alert! Attendance below 75%</p>`;

      card.innerHTML=html;
      attendanceList.appendChild(card);
    });
  });
}

loadAttendance();
</script>
</body>
</html>
